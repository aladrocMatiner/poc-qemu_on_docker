---
- name: Swarm status (manager)
  hosts: swarm_managers
  become: true
  gather_facts: false

  tasks:
    - name: Swarm local state
      ansible.builtin.command: !unsafe docker info --format '{{.Swarm.LocalNodeState}}'
      register: swarm_state
      changed_when: false

    - name: Swarm node list
      ansible.builtin.command: docker node ls --format '{{.Hostname}} {{.Status}} {{.Availability}} {{.ManagerStatus}}'
      register: swarm_nodes
      changed_when: false

    - name: Print swarm status
      ansible.builtin.debug:
        msg:
          - "Swarm state: {{ swarm_state.stdout | default('unknown') }}"
          - "Nodes:"
          - "{{ swarm_nodes.stdout_lines | default([]) }}"
