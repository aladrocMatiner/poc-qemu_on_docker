# =========================
# Project: poc-qemu_on_docker
# Phase 1: Local Swarm Lab (QEMU VMs)
# Copy to .env and adjust.
# =========================

# Lab identity
LAB_NAME=swarm-lab
LAB_NODES=4

# Paths (relative recommended)
WORKDIR=work
IMAGES_DIR=work/images
SEEDS_DIR=work/seeds
LOGS_DIR=work/logs
DOWNLOADS_DIR=work/downloads
# Libvirt storage pool path (avoid $HOME to prevent qemu permission errors)
# Example: /var/lib/libvirt/images/swarm-lab-pool
POOL_PATH=/var/lib/libvirt/images/swarm-lab-pool
# Auto-fix libvirt pool permissions for the qemu user (requires sudo).
LIBVIRT_POOL_FIX_PERMS=1
LIBVIRT_QEMU_USER=libvirt-qemu
LIBVIRT_QEMU_GROUP=kvm
TOFU_STATE_DIR=work/tofu-state

# OpenTofu
INFRA_DIR=infra
TOFU_BIN=tofu
LIBVIRT_URI=qemu:///system
# CPU mode for lab VMs. Use host-passthrough to expose nested virtualization (/dev/kvm inside VMs).
# Set to "none" to avoid overriding CPU mode (nested KVM inside lab VMs will not work).
LIBVIRT_CPU_MODE=host-passthrough

# Base cloud image (Ubuntu example)
BASE_IMAGE_NAME=ubuntu-24.04-server-cloudimg-amd64.img
BASE_IMAGE_URL=https://cloud-images.ubuntu.com/releases/24.04/release/ubuntu-24.04-server-cloudimg-amd64.img

# VM sizing
VM_CPU=2
VM_RAM_MB=4096
VM_DISK_GB=20

# Networking
# Swarm NIC attaches to this host bridge (must exist)
SWARM_BRIDGE=br0

# Management access:
# - user: QEMU user-mode networking + hostfwd ports for SSH (simplest and safe)
# - bridge: attach mgmt NIC to a host bridge (more realistic)
MGMT_MODE=user
MGMT_BRIDGE=br-mgmt
MGMT_NETWORK=default
# Optional: if set, the lab will create/manage this libvirt network.
# Use a non-default name (e.g., swarm-lab-mgmt) when enabling this.
# Example: 192.168.122.0/24
MGMT_NETWORK_CIDR=
# If MGMT_NETWORK_CIDR is set, assign fixed mgmt IPs starting at this host number.
MGMT_IP_START=10

# Libvirt security labeling: auto detects AppArmor support.
# auto     => use AppArmor seclabel if available, otherwise none
# apparmor => force AppArmor seclabel (fails if not supported)
# none     => do not inject seclabel
LIBVIRT_SECLABEL_MODE=auto

# If MGMT_MODE=user, node i SSH is localhost:(MGMT_SSH_FWD_BASE+i)
MGMT_SSH_FWD_BASE=2220

# Deterministic MAC addressing
# Node i MAC becomes: MAC_PREFIX:XX where XX = i in hex (01..)
MAC_PREFIX=52:54:00:ab:cd

# SSH
SSH_USER=ubuntu
SSH_PUBKEY_PATH=~/.ssh/id_ed25519.pub

# VM runner SSH key (used by case01-test to reach the VM from inside the runner)
VM_RUNNER_KEYS_DIR_HOST=/var/lib/vmrunner/keys
VM_RUNNER_KEYS_DIR_CONTAINER=/vm/keys
VM_SSH_KEY_PATH_IN_CONTAINER=/vm/keys/id_ed25519

# Ansible
ANSIBLE_DIR=ansible
ANSIBLE_CFG=ansible/ansible.cfg
ANSIBLE_INVENTORY=ansible/inventories/generated/inventory.ini
ANSIBLE_SSH_USER=${SSH_USER}
ANSIBLE_SSH_PRIVATE_KEY=~/.ssh/id_ed25519
ANSIBLE_FORKS=10
ANSIBLE_BECOME=1
ANSIBLE_EXTRA_VARS_FILE=ansible/group_vars/all.yml
ANSIBLE_LIMIT=
ANSIBLE_TAGS=

# Bootstrap toggles
BOOTSTRAP_INSTALL_ANSIBLE=1

# Optional knobs
MTU_HINT=1500
