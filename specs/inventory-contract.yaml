id: inventory-contract
title: Inventory schema contract
status: draft
owner_agent: platformqa
priority: high

problem_statement: |
  Multiple tools rely on `work/inventory.json`. A stable schema contract is
  required to keep SSH, Ansible, and tests consistent.

scope:
  - Define required inventory fields and schema versioning
  - Validate required fields after lab-status

non_goals:
  - Complex inventory transforms or secret storage

constraints:
  - No secrets in inventory
  - Schema changes require version bump

assumptions:
  - Inventory is generated by tofu outputs

interfaces:
  inputs:
    - work/inventory.json
  outputs:
    - Schema validation result

acceptance_tests:
  - name: lab-up
    command: "make lab-up"
    expected: "exit code 0"
  - name: lab-status
    command: "make lab-status"
    expected: "inventory.json created"
  - name: inventory-schema
    command: "jq -e '.lab_name and .schema_version and .nodes' work/inventory.json"
    expected: "exit code 0"

rollback:
  - make lab-destroy
  - remove work/inventory.json

security_considerations:
  - Do not include secrets
  - Limit access to inventory artifacts

artifacts_produced:
  - docs/inventory-schema.md

dependencies:
  - tofu-inventory-access

related_skills:
  - tofu_inventory_and_access

related_docs:
  runbooks:
    - docs/inventory-schema.md
  adrs:
    - docs/adr/0002-inventory-contract.md
